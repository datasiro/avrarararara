<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NAI PNG ë©”íƒ€ë°ì´í„° ì œê±°ê¸° (ìë™/ìˆ˜ë™/ZIP ì§€ì›)</title>
  <style>
    :root{
      --bg:#0b0f14;--card:#121823;--muted:#2a3340;--text:#eaf2ff;--sub:#9fb2cc;--accent:#7aa2ff;--ok:#38d39f;--warn:#ffcf5a;--err:#ff6b6b
    }
    *{box-sizing:border-box}body{margin:0;background:linear-gradient(180deg,#0b0f14,#0e1219 50%,#0b0f14);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial}
    header{padding:28px 20px 10px;text-align:center}
    h1{font-size:24px;margin:0 0 8px}p.lead{margin:0;color:var(--sub)}
    .wrap{max-width:940px;margin:16px auto 40px;padding:0 16px}
    .card{background:var(--card);border:1px solid #162233;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden}
    .toolbar{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--muted)}
    .left, .right{display:flex;gap:12px;align-items:center}
    .btn{appearance:none;border:1px solid var(--muted);background:#101827;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
    .btn:hover{border-color:#395070}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#051028}
    .btn.primary:disabled{opacity:.5;cursor:not-allowed}
    .drop{padding:18px;border:2px dashed #324056;border-radius:14px;margin:16px;background:#0e1520;text-align:center;color:var(--sub)}
    .drop.dragover{border-color:var(--accent);color:var(--accent)}
    .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;padding:16px}
    .item{background:#0d1420;border:1px solid #1c2a3d;border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
    .thumb{display:block;width:100%;height:140px;object-fit:cover;background:#0a111b}
    .meta{padding:6px 8px;font-size:12px;color:var(--sub);display:flex;justify-content:space-between;align-items:center}
    .actions{padding:6px 8px;display:flex;gap:6px;justify-content:flex-end}
    .log{padding:12px 16px;border-top:1px solid var(--muted);max-height:160px;overflow:auto;font-family:ui-monospace,Consolas,Menlo,monospace;font-size:12px;background:#0c1320}
    .ok{color:var(--ok)}.warn{color:var(--warn)}.err{color:var(--err)}
    footer{max-width:940px;margin:16px auto 40px;padding:0 16px;color:var(--sub);text-align:center}
    a{color:var(--accent)}
    input.nameprefix{padding:10px 12px;border-radius:12px;border:1px solid var(--muted);background:#101827;color:var(--text);min-width:120px}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
  <header>
    <h1>NAI PNG ë©”íƒ€ë°ì´í„° ì œê±°ê¸°</h1>
    <p class="lead">PNGì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì œê±°í•˜ê³  ì¬ì €ì¥í•©ë‹ˆë‹¤.<br/>ìë™ ë‹¤ìš´ë¡œë“œ / ê°œë³„ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ / ZIP ë‹¤ìš´ë¡œë“œ ëª¨ë‘ ì§€ì›í•©ë‹ˆë‹¤.</p>
  </header>
  <div class="wrap">
    <div class="card">
      <div class="toolbar">
        <div class="left">
          <label class="btn">
            íŒŒì¼ ì„ íƒ
            <input id="file-input" type="file" accept="image/*" multiple hidden />
          </label>
          <button id="clear" class="btn" type="button">ì´ˆê¸°í™”</button>
          <input id="name-prefix" class="nameprefix" type="text" placeholder="íŒŒì¼ëª… ì ‘ë‘ì–´ (ê¸°ë³¸: ìˆ«ìë§Œ)" />
        </div>
        <div class="right" style="flex-wrap:wrap;gap:6px">
          <label>ì €ì¥ í¬ë§·
            <select id="out-format" class="btn" style="padding-right:32px">
              <option value="png" selected>PNG</option>
              <option value="jpeg">JPEG</option>
              <option value="webp">WEBP</option>
            </select>
          </label>
          <button id="process-list" class="btn primary" type="button">ëª©ë¡ ì¶”ê°€</button>
          <button id="process-auto" class="btn" type="button">ìë™ ë‹¤ìš´ë¡œë“œ</button>
          <button id="process-zip" class="btn" type="button">ZIP ë‹¤ìš´ë¡œë“œ</button>
        </div>
      </div>

      <div id="drop" class="drop">ì—¬ê¸°ì— ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ê±°ë‚˜, ìƒë‹¨ì˜ <b>íŒŒì¼ ì„ íƒ</b>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
      <div id="list" class="list"></div>
      <pre id="log" class="log"></pre>
    </div>
  </div>

  <footer>
    <p>ëª¨ë“  ì²˜ë¦¬ëŠ” ë¸Œë¼ìš°ì € ë¡œì»¬ì—ì„œë§Œ ìˆ˜í–‰ë©ë‹ˆë‹¤.</p>
  </footer>

  <script>
  const state = { files: [], counterStart: 1, results: [] }
  const el = (id)=>document.getElementById(id);
  const $drop = el('drop'), $list=el('list'), $log=el('log');

  function log(msg, cls=""){
    const line = document.createElement('div');
    if(cls) line.className = cls;
    line.textContent = msg;
    $log.appendChild(line);
    $log.scrollTop = $log.scrollHeight;
  }

  function renderList(){
    $list.innerHTML = '';
    if(state.results.length===0){
      $list.innerHTML = '<div class="item" style="display:flex;align-items:center;justify-content:center;height:140px;color:var(--sub)">ì²˜ë¦¬ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'
      return;
    }
    state.results.forEach(r=>{
      const card = document.createElement('div');card.className='item';
      const img = document.createElement('img');img.className='thumb';
      img.src = URL.createObjectURL(r.blob);
      const meta = document.createElement('div');meta.className='meta';
      meta.innerHTML = `<span>${r.filename}</span><span>${(r.blob.size/1024).toFixed(1)} KB</span>`;
      const actions = document.createElement('div');actions.className='actions';
      const btn = document.createElement('a');
      btn.href = img.src; btn.download = r.filename; btn.className='btn'; btn.textContent='ë‹¤ìš´ë¡œë“œ';
      actions.appendChild(btn);
      card.appendChild(img);card.appendChild(meta);card.appendChild(actions);
      $list.appendChild(card);
    })
  }

  function onFilesPicked(files){
    const imgs = [...files].filter(f=>f.type.startsWith('image/'));
    state.files.push(...imgs);
    log(`${imgs.length}ê°œ ì´ë¯¸ì§€ ì¶”ê°€ë¨.`,'ok');
  }

  // FileReader ê¸°ë°˜ ë³€í™˜ (ëª¨ë°”ì¼ í˜¸í™˜ì„± â†‘)
  function convertToBlob(sourceBlob, targetFormat){
    return new Promise((resolve,reject)=>{
      const reader = new FileReader();
      reader.onload = ()=>{
        const img = new Image();
        img.onload=()=>{
          try{
            const canvas=document.createElement('canvas');
            canvas.width=img.width; canvas.height=img.height;
            const ctx=canvas.getContext('2d');
            ctx.drawImage(img,0,0);
            canvas.toBlob(b=>{
              if(b) resolve(b);
              else reject(new Error('toBlob ì‹¤íŒ¨'));
            }, `image/${targetFormat}`,1.0);
          }catch(err){ reject(err); }
        };
        img.onerror=()=>reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
        img.src=reader.result;
      };
      reader.onerror=()=>reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
      reader.readAsDataURL(sourceBlob);
    });
  }

  async function processImageBlob(originalBlob, finalFormat){
    const tempJpeg = await convertToBlob(originalBlob,'jpeg');
    if(finalFormat==='jpeg') return {blob:tempJpeg,format:'jpeg'};
    const finalBlob = await convertToBlob(tempJpeg, finalFormat);
    return {blob:finalBlob,format:finalFormat};
  }

  async function processFiles(addToListOnly=false, autoDownload=false){
    const outFmt = el('out-format').value;
    const prefix = el('name-prefix').value.trim();
    if(state.files.length===0){ log('ì²˜ë¦¬í•  ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.','warn'); return; }

    log(`${state.files.length}ê°œ ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹œì‘...`);
    let num=state.counterStart;
    const results=[];
    for(const file of state.files){
      try{
        const {blob,format}=await processImageBlob(file,outFmt);
        const baseName=prefix?`${prefix} ${num}`:`${num}`;
        const filename=`${baseName}.${format}`;
        num++;
        results.push({blob,filename});
        if(autoDownload){
          const a=document.createElement('a');
          const href=URL.createObjectURL(blob);
          a.href=href; a.download=filename;
          document.body.appendChild(a); a.click(); a.remove();
          setTimeout(()=>URL.revokeObjectURL(href),1500);
        }
        log(`ì„±ê³µ: ${filename}`,'ok');
      }catch(err){
        log(`ì˜¤ë¥˜ (${file.name}): ${err.message}`,'err');
      }
    }

    if(addToListOnly){
      state.results=results; renderList();
    }
    if(!addToListOnly && !autoDownload){
      const zip=new JSZip();
      results.forEach(r=>zip.file(r.filename,r.blob));
      const content=await zip.generateAsync({type:"blob"});
      saveAs(content,(prefix||'images')+".zip");
      log("ZIP ë‹¤ìš´ë¡œë“œ ì™„ë£Œ",'ok');
    }

    // ğŸ‘‰ ë” ì´ìƒ ìë™ìœ¼ë¡œ state.files = [] ë¹„ìš°ì§€ ì•ŠìŒ
    log('ëª¨ë“  ì´ë¯¸ì§€ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }

  // ì´ë²¤íŠ¸
  el('file-input').addEventListener('change',e=>{onFilesPicked(e.target.files); e.target.value='';});
  el('clear').addEventListener('click',()=>{state.files=[];state.results=[];renderList();log('ëª©ë¡ì´ ë¹„ì›Œì¡ŒìŠµë‹ˆë‹¤.');});
  el('process-list').addEventListener('click',()=>processFiles(true,false));
  el('process-auto').addEventListener('click',()=>processFiles(false,true));
  el('process-zip').addEventListener('click',()=>processFiles(false,false));

  ['dragenter','dragover'].forEach(ev=>{
    $drop.addEventListener(ev,e=>{e.preventDefault();e.stopPropagation();$drop.classList.add('dragover');});
  });
  ['dragleave','drop'].forEach(ev=>{
    $drop.addEventListener(ev,e=>{e.preventDefault();e.stopPropagation();$drop.classList.remove('dragover');});
  });
  $drop.addEventListener('drop',e=>{onFilesPicked(e.dataTransfer.files);});

  renderList();
  </script>
</body>
</html>
